#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Validando conventional commit..."

# Leer mensaje del commit
commit_msg=$(cat "$1")

# Patrón para conventional commits
pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,72}$"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
    echo ""
    echo "❌ COMMIT RECHAZADO!"
    echo ""
    echo "📋 Formato requerido: <type>[scope]: <description>"
    echo ""
    echo "🎯 Tipos válidos:"
    echo "  feat:     Nueva funcionalidad"
    echo "  fix:      Corrección de bug"
    echo "  docs:     Documentación"
    echo "  style:    Formateo de código"
    echo "  refactor: Refactorización"
    echo "  perf:     Mejora de rendimiento"
    echo "  test:     Tests"
    echo "  build:    Cambios en build/deps"
    echo "  ci:       CI/CD"
    echo "  chore:    Tareas de mantenimiento"
    echo ""
    echo "✅ Ejemplos válidos:"
    echo "  feat(api): add user authentication"
    echo "  fix(domain): resolve null reference in Payment"
    echo "  docs: update API documentation"
    echo ""
    echo "❌ Tu mensaje: \"$commit_msg\""
    exit 1
fi

echo "✅ Commit válido!"
